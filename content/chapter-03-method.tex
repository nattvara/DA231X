\chapter{Method or Methods}
\label{ch:methods}


% \sweExpl{Metod eller Metodval}
% \generalExpl{This chapter is about Engineering-related
%   content, Methodologies and Methods.  Use a self-explaining title.\\The
%   contents and structure of this chapter will change with your choice of
%   methodology and methods.}




% \generalExpl{Describe the engineering-related contents (preferably with models) and the research methodology and methods that are used in the degree project.\\
% Give a theoretical description of the scientific or engineering methodology  you are going to use and why have you chosen this method. What other methods did you consider and why did you reject them?\\
% In this chapter, you describe what engineering-related and scientific skills you are going to apply, such as modeling, analyzing, developing, and evaluating engineering-related and scientific content. The choice of these methods should be appropriate for the problem. Additionally, you should be conscious of aspects relating to society and ethics (if applicable). The choices should also reflect your goals and what you (or someone else) should be able to do as a result of your solution - which could not be done well before you started.}


% The purpose of this chapter is to provide an overview of the research method
% used in this thesis. Section~\ref{sec:researchProcess} describes the research
% process. Section~\ref{sec:researchParadigm} details the research
% paradigm. Section~\ref{sec:dataCollection} focuses on the data collection
% techniques used for this research. Section~\ref{sec:experimentalDesign}
% describes the experimental design. Section~\ref{sec:assessingReliability}
% explains the techniques used to evaluate the reliability and validity of the
% data collected. Section~\ref{sec:plannedDataAnalysis} describes the method
% used for the data analysis. Finally, Section~\ref{sec:evaluationFramework}
% describes the framework selected to evaluate xxx.




This chapter outlines the methodologies and procedures used for conducting the research described in this thesis. The focus is on presenting the chosen methods for data collection, analysis, and evaluation of the deployment and effectiveness of AI-assistants within Canvas course rooms at KTH.
% \sweExpl{Vilka vetenskaplig eller ingenjörs-metodik ska du använda och varför har du valt den här metoden. Vilka andra metoder gjorde du övervägde du och varför du avvisar dem.
% Vad är dina mål? (Vad ska du kunna göra som ett resultat av din lösning - vilken inte kan göras i god tid innan du började)
% Vad du ska göra? Hur? Varför? Till exempel, om du har implementerat en artefakt vad gjorde du och varför? Hur kommer du utvärdera den.
% Syftet med detta kapitel är att ge en översikt över forsknings metod som
% används i denna avhandling. Avsnitt~\ref{sec:researchProcess} beskriver forskningsprocessen. Avsnitt~\ref{sec:researchParadigm} beskriver forskningsparadigmen detaljerat. Avsnitt~\ref{sec:dataCollection} fokuserar på datainsamlingstekniker som används för denna forskning. Avsnitt~\ref{sec:experimentalDesign} beskriver experimentell
% design. Avsnitt~\ref{sec:assessingReliability} förklarar de tekniker som används för att utvärdera
% tillförlitligheten och giltigheten av de insamlade uppgifterna. Avsnitt~\ref{sec:plannedDataAnalysis}
% beskriver den metod som används för dataanalysen. Slutligen, Avsnitt~\ref{sec:evaluationFramework}
% beskriver ramverket som valts för att utvärdera xxx.\\
% Ofta kan man koppla ett antal följdfrågor till undersökningsfrågan och problemlösningen t ex\\
% (1) Vilken process skall användas för konstruktion av lösningen och vilken process skall kopplas till denna för att svara på undersökningsfrågan?\\
% (2) Hur och vilket resultat (storheter) skall presenteras både för att redovisa svar på undersökningsfrågan (resultatkapitlet i denna rapport) och redovisa resultat av problemlösningen (prototypen, ofta dokument som bilagor men vilka dokument och varför?).\\
% (3) Vilken teori/teknik skall väljas och användas både för undersökningen (taxonomi, matematik, grafer, storheter mm)  och  problemlösning (UML, UseCases, Java mm) och varför?\\
% (4) Vad behöver du som student leverera för att uppnå hög kvaliet (minimikrav) eller mycket hög kvalitet på examensarbetet?\\
% (5) Frågorna kopplar till de följande underkapitlen.\\
% (6) Resonemanget bygger på att studenter på hing-programmet ofta skall konstruera något åt problemägaren och att man till detta måste koppla en intressant ingenjörsfråga. Det finns hela tiden en dualism mellan dessa aspekter i exjobbet.
% }


\section{Research Process}
\label{sec:research_process}


The research process within this thesis consisted of three main phases. This section will outline each phase and what the purpose was.


\subsection{Prof of concept}


The study will aim to achieve an assistant using open source and permissively licensed \gls{LLM}s and \gls{RAG} techniques, that is comparable to the current best in class models provided under less permissive licesnses and are only available through properitery APIs. Considering that this is a fairly complex task, the research started with a long phase of constructing various proof of concepts.


There would be two main proof of concepts, one using proprietary models and \gls{RAG} techniques, and one strictly using software that is under open source licenses and can be self-hosted.


\subsection{Implementation of study software}


The second phase consists of constructing the software that will be used during the study. This software is the actual AI assistant and all its components, such as the course room crawler and indexer, the infrastructure to run \gls{LLM}s at scale and a \gls{GUI} to interact with the assistant. This software also needs to be able to exchange various different components that are the subject for the study, such as the \gls{LLM} being used in a chat. Furthermore, the software needs to be able to record user interactions and responses to questions.


\subsection{Conduct the study at KTH}


This phase consists of deploying and monitoring the assistant in the course rooms that have enrolled in the study. This might involve modifying the software such that it works in the new course room, or ensuring that there is enough capacity on the platform to sustain the new users.


\subsection{Analyse results}


Once the study has concluded the data analysis will be conducted, the final results and analysis can be found in \autoref{ch:resultsAndAnalysis}. The various different data points collected in the experiments were all stored in a database. Once the study concluded, the analysis was done using different python jupyter notebooks. The notebooks can be found in the github repository for this thesis \footnote{\href{https://github.com/nattvara/DA231X/tree/main/results/notebooks}{github.com/nattvara/DA231X/results/notebooks}}. There are three notebooks, one for each theme.


The first is the \textit{"usage"} notebook. This contains the charts and tables constructed to analyse the general usage of the assistant in all courses. These cover metrics like, how many messages were sent, how many chats were held, users registered in each course, etc. The second notebook is the \textit{"feedback"} notebook. This notebook contains an analysis of all user submitted responses to the feedback questions. The third and last notebook is the \textit{"performance"} notebook. This notebook contains charts and tables that analyse all performance metrics collected by the system, such as how quickly models produced response to prompts, how long indexing took, etc.




% \sweExpl{Undersökningsrocess och utvecklingsprocess}


% \sweExpl{Figur~\ref{fig:researchprocess} visar de steg som utförs för att genomföra\\
% Beskriv, gärna med ett aktivitetsdiagram (UML?), din undersökningsprocess och utvecklingsprocess.  Du måste koppla ihop det akademiska intresset (undersökningsprocess) med ursprungsproblemet (utvecklingsprocess)
% denna forskning.\\
% Aktivitetsdiagram från t ex UML-standard}






% \generalExpl{Example of using customized item labels.}
% Some steps in the process:
% \begin{enumerate}[leftmargin=*, label=\textbf{Step \arabic*}, ref=Step \arabic*] %labelindent=1em for indent
%         \itemsep0em
%         \item \label{x:s1} plan experiment,
%         \item \label{x:s2} conduct experiment,
%         \item \label{x:s3} analyze data from the experiment, and
%         \item \label{x:s4} discuss the results of the analysis.
% \end{enumerate}


\section{Research Paradigm}
\label{sec:researchParadigm}


% \sweExpl{Undersökningsparadigm\\
% Exempelvis\\
% Positivistisk (vad/hur fungerar det?) kvalitativ fallstudie med en deduktivt (förbestämd) vald ansats och ett induktivt(efterhand uppstår dataområden och data) insamlade av data och erfarenheter.}


This research in this thesis follows a pragmatic approach that blends aspects of the study from positivist paradigms to investigate the practical application and user reception of AI assistants generally within the educational setting. Additionally, it seeks to determine which technologies perform best by analysing segmented responses to user queries based on the specific technologies used to generate the answers.
The pragmatic approach supports using mixed methods to answer the research questions effectively, focusing on 'what works' as the basis for knowledge claims. The positivist elements of the study will quantify which technologies deliver the fastest responses and yield the most usage among users. Participants will be exposed to one technology from a predefined set, selected through random sampling. This methodological approach allows for a positivist analysis to determine which technology is the fastest and most preferred by its users.


The collection and analysis of the feedback from the participants in the study is an interpretivisit approach to answer the questions of more subjective nature. These are questions like which technologies or models generate the most accurate results, or answers that are more preferred by users.


To summarise, initially the chatbot is deployed (positivist approach), followed by the collection and analysis of user feedback (interpretivist approach) to understand the broader implications of AI-assistant technology in specialised domains such as education. This method aims to understanding the functional capabilities of the AI-assistant in addition to its practical utility and acceptance by end-users, students and teachers.




\section{Data Collection}
\label{sec:dataCollection}


% \sweExpl{Datainsamling\\
% (Detta bör också visa att du är medveten om de sociala och etiska frågor som
% kan vara relevanta för dina data insamlingsmetod.)}
% \generalExpl{This should also show that you are aware of the social and ethical concerns that might be relevant to your data collection method.}


The data collection in this study comes from two sources;


\begin{itemize}
        \item The AI-assistant software built to conduct this research. This includes metrics from the usage of the system, in addition to integrated survey components of the system such as responses to questions from users of the system.
        \item Responses to coursework questions from students in selected courses that are part of the study, submitted as part of their course requirements.
\end{itemize}


\subsection{Data collected by the software constructed for this study}


The AI-assistant software was constructed to record various pieces of data, these can be grouped into four categories, operational data, usage data, performance data, feedback data. The data collected by the AI-assistant is anonymous. No personal information was recorded by the system, aside from any information that may have been submitted as part of a question by the user to the assistant.


\subsubsection{Operational data}


The operational data refers to data collected by the system to function. This includes information in or about the course rooms such as the various pieces of content found in a course room and their relations. This can be lecture slides, lab assignments, links to external sites etc.


\subsubsection{Usage data}


Usage data in system refers to data that is generated when users use the system. This includes session information and its metadata, chat information such as which course room a chat is associated with and which messages were sent by the user and the ai-assistant in each chat.


\subsubsection{Performance data}


Various metrics regarding the performance of the system are also computed and kept. These include metrics such as how quickly a model generates a response to a given prompt and how long the response. Also, how quickly a vector embedding was computed and how quickly the index returns documents.


\subsubsection{Feedback data}
\label{sec:method_feedback_data}




The feedback data is the most intentional data tracked by the system. This includes questions injected into the chat at specified intervals. These questions and intervals are the same for all users. The questions have a predefined set of answers and the system tracks which of the answers a user selects, or if they don’t select any answer at all. In addition binary thumbs up/down questions are also asked about certain responses from the system.


\subsection{Data collected by questions in the coursework}


In the courses that agreed, a form was distributed to all their students. The form was designed to gather insights as to why students replied like they did in the feedback questions. The form was slightly different in each course depending on the demographic of the participating students. For instance, one course was designed for maths teachers, therefore their form included questions meant to gather insights from the teaching viewpoint. The forms, their questions and responses, can be viewed in their entirety in \autoref{appendix:mg2040_form}, \autoref{appendix:ld1000_form} and \autoref{appendix:ld1006_form}. The qualitative analysis was very high-level, as it was not the primary form of gathering data for this study. The qualitative analysis can be found in section~\ref{sec:qualitative_analysis_of_user_responses}.


% \subsection{Sampling}
% not sure how i’d use these
% \subsection{Sample Size}


\subsection{The participants in the study}


The study sources its participants from courses from course administrators that have volunteered for their courses to participate in the study. The courses were found by emailing course responsibles at the EECS school at KTH in addition to connections of the supervisors of this thesis. \autoref{tab:courses_credits_students} shows the courses the participating students were taking.


\input{content/tables/10-courses-that-participated-in-study}


\section[Experimental design/Planned Measurements]{Experimental design and\\Planned Measurements}
\label{sec:experimentalDesign}


Participants in the study will be randomly assigned to groups, each of which will use a specific set of technologies and techniques. This random assignment will be managed by software written for this study, and it will apply to every chat session started with the assistant by the participating student. Each group will utilise a unique configuration based on one of these predefined parameters;


\begin{itemize}
        \item The language model used to run the chat. This is the \gls{LLM} that is used to generate chat replies within the chat. It’s also used for the internal logic of the assistant. This internal logic consists of tasks such as identifying whether the user asked the assistant a question that needs data from the knowledgebase.
        \item The \gls{RAG} technique and technology used to access the indexed data. This could be \gls{TF-IDF} or an embedding function. The latter group also has a defined embedding model assigned.
        \item Post processing of the retrieved documents. This is a boolean flag that configures the assistant to post process documents before inserting them into the context window for the configured \gls{LLM} to generate an answer with.
\end{itemize}


The software allows for questions to be inserted into a chat the participant is having using the following two triggers.


\begin{enumerate}
        \item After a participant has had $n$ chats and is sending the $m$:th message in that chat
        \item After a student clicks one of the frequently asked questions
\end{enumerate}


Each of these triggers allows for inserting any given number of questions into the chat. Any question has to follow one of the following templates;


\begin{enumerate}[label=\alph*)]
        \item A question, such as \textit{"Was this a good answer?"} accompanied with a "thumbs up" or a "thumbs down" button to answer the question with.
        \item A question, such as \textit{"How accurate did you find this answer?"} with a set of answers to select from such as \textit{Very accurate}, \textit{Somewhat accurate}, \textit{Neither accurate nor inaccurate}, \textit{Somewhat inaccurate}, \textit{Very inaccurate}.
\end{enumerate}


With these configurations, the experiment aims to measure the impact of the predefined parameters on users' responses to the questions posed during the chats at the configured triggers.


\section{Test environment}


% \engExpl{Describe everything that someone else would need to reproduce your test environment/test bed/model/… .}
% \sweExpl{Testmiljö/testbädd/modell\\
% Beskriv allt att någon annan skulle behöva återskapa din testmiljö / testbädd / modell / …}


\subsection{Software}


To reproduce the results of this study the software that was written to crawl course rooms, index their content and host the chat with the assistant is available in its entirety on github, see \autoref{appendix:source_code}.


\subsection{Configuration}


There is quite a bit of configuration needed to get the software operational. The \textit{README} in the source code extensively covers how to run the software in most common environments, see \autoref{appendix:source_code}.


\subsection[Data/Access to Canvas]{Data and access to canvas}


To run the AI assistant with data from an actual course room the bot needs to have access to a canvas through a KTH registered user. Due to time constraints the option to use the official Canvas API was abandoned early in the planning of this study. The softwares’ crawler therefore needs the cookies of an authenticated user with access to the course rooms included in the study.


\textbf{note: maybe explore publishing the course content of some course rooms? As like a downloadable from the github repo or something?}


\subsection{Models}


The software constructed for the study utilise the transformers python library \footnote{The GitHub page for the transformers library \href{https://github.com/huggingface/transformers}{/github.com/huggingface/transformers} (accessed on \today)} maintained by HuggingFace. The library manages the download and loading of the open source \gls{LLM}s and embedding models used in the thesis. This also means that if the models are no longer available on the huggingface registry, or the registry is nonoperational, the models have to be obtained by other means. The open source models that are supported by the software are the following models


\begin{itemize}
        \item The Mistral-7B-Instruct, provided by MistralAI, \footnote{\href{https://huggingface.co/mistralai/Mistral-7B-Instruct-v0.2}{huggingface.co/mistralai/Mistral-7B-Instruct-v0.2} (accessed on \today)}
        \item The Gemma-7B, provided by Google, \footnote{\href{https://huggingface.co/google/gemma-7b}{huggingface.co/google/gemma-7b} (accessed on \today)}
        \item The Falcon-7B, provided by TII UAE, \footnote{\href{https://huggingface.co/tiiuae/falcon-7b}{huggingface.co/tiiuae/falcon-7b} (accessed on \today)}
        \item The SFR-Embedding-Mistral, provided by Salesforce, \footnote{\href{https://huggingface.co/Salesforce/SFR-Embedding-Mistral}{huggingface.co/Salesforce/SFR-Embedding-Mistral} (accessed on \today)}
        \item The Meta-Llama-3-8B-Instruct, provided by Meta, \footnote{\href{https://huggingface.co/meta-llama/Meta-Llama-3-8B-Instruct}{huggingface.co/meta-llama/Meta-Llama-3-8B-Instruct} (accessed on \today)}
\end{itemize}


In addition to the open source models the software also supports experiments using some proprietary models by OpenAI. The two models that are supported are the \textit{GPT-4} model and the \textit{text-embedding-3-large} embedding model \footnote{\href{https://platform.openai.com/docs/guides/embeddings}{platform.openai.com/docs/guides/embeddings/} (accessed on \today)}. Both of these are accessible using the python API \footnote{\href{https://github.com/openai/openai-python}{github.com/openai/openai-python} (accessed on \today)} which require an OpenAI subscription and API key.


\subsection{Hardware}


The study software should be able to execute on most common hardware and most parts of the application are not particularly compute intensive. The notable exception to this is the worker processes in the \text{LLM Service} part of the software that, depending on the model, run quite intensive compute loads. That is unless the agent runs either of the proprietary cloud hosted models provided by OpenAI.


If the agent is running one of the \gls{LLM}s it can run, such as the \textit{Mistral 7B instruct} model, the agent needs access to a quite capable GPU. For the supported models this needs to be a GPU with at least 24 GB of video memory. Example of such graphics cards are \textit{NVIDIA GeForce RTX 3090}\footnote{\href{https://www.nvidia.com/sv-se/geforce/graphics-cards/30-series/rtx-3090-3090ti/}{nvidia.com/sv-se/geforce/graphics-cards/30-series/rtx-3090-3090ti/} (accessed on \today)}, \textit{NVIDIA TITAN RTX}\footnote{\href{https://www.nvidia.com/en-eu/deep-learning-ai/products/titan-rtx/}{nvidia.com/en-eu/deep-learning-ai/products/titan-rtx/} (accessed on \today)} or \textit{NVIDIA A10 Tensor Core}\footnote{\href{https://www.nvidia.com/en-us/data-center/products/a10-gpu/}{nvidia.com/en-us/data-center/products/a10-gpu/} (accessed on \today)}. This used servers on AWS, specifically the G5 instances (g5.4xlarge) equipped with \textit{NVIDIA A10 Tensor Core} GPUs \footnote{\href{https://aws.amazon.com/ec2/instance-types/g5/}{aws.amazon.com/ec2/instance-types/g5/} (accessed on \today)}. The open source embedding models such as \textit{SFR-Embedding-Mistral} can be run on CPUs, which only require the same amount of RAM available to run the models.


\section{Assessing reliability and validity of the data collected}
\label{sec:assessingReliability}


% \sweExpl{Bedömning av validitet och reliabilitet hos använda metoder och insamlade data }




\subsection{Validity of method}
\label{sec:validtyOfMethod}


% \sweExpl{Giltigheten av metoder\\
%   Har dina metoder gett dig de rätta svaren och lösningarna? Var metoderna korrekta?}


% \engExpl{How will you know if your results are valid?}
% \engExpl{Remember that validity is about the \textit{accuracy} of a measurement while reliability is about the \textit{consistency} of the measurement values under the same conditions (\ie repeatability).}


To research how well AI-assistants work in a specialised domain, other methods could’ve been used. For instance, instead of building an assistant and deploying it, the thesis could’ve explored similar domains and drawn conclusions from the success of similar systems in similar domains. However, actually implementing an assistant and evaluating its efficacy using standard methods such as \gls{TAM} and \gls{ECM} is a more accurate way of measuring the research questions laid out.


\subsection{Reliability of method}
\label{sec:reliabilityOfMethod}


% \sweExpl{Tillförlitlighet av för metoder\\
% Hur bra är dina metoder, finns det bättre metoder? Hur kan du förbättra dem?}
% \engExpl{How will you know if your results are reliable?}


The methods used in this study, including those for measuring user acceptance of the tool, are considered reliable. However, the results of the study will be heavily impacted by the type of users using the tool. Given the research is taking place at the division of robotics at a technical university, the participating courses are mostly technical courses with tech savvy students. To reproduce the results of this study it would have to closely reproduce the student population participating in the study. To increase the reliability of the method in this study the research could have been performed at a wider array of universities with a more diverse student population.


\subsection{Data validity}
\label{sec:dataValidity}


% \sweExpl{Giltigheten av uppgifter\\
% Hur vet du om dina resultat är giltiga? Är ditt resultat rättvisande?}

% TODO: after the results section has been written.


% \subsection{Reliability of data}
% \label{sec:reliabilityOfData}




% \sweExpl{Tillförlitlighet av data\\
% Hur vet du om dina resultat är tillförlitliga? Hur bra är dina resultat?}


% TODO: after the results section has been written.


% \section{Planned Data Analysis}
% \label{sec:plannedDataAnalysis}


% \sweExpl{Metod för analys av data}


% TODO: after the results section has been written.


% \subsection{Data Analysis Technique}
% \label{sec:dataAnalysisTechnique}


% TODO: after the results section has been written.


% \subsection{Software Tools}
% \label{sec:softwareTools}


% TODO: after the results section has been written.


% \section{Evaluation framework}
% \label{sec:evaluationFramework}


% TODO: after the results section has been written.


% \sweExpl{Utvärdering och ramverk\\
% Metod för utvärdering, jämförelse mm. Kopplar till kapitel~\ref{ch:resultsAndAnalysis}.}


\section{System documentation}
\label{sec:systemDocumentation}


% \sweExpl{Systemdokumentation\\
% Med vilka dokument och hur skall en konstruerad prototyp dokumenteras? Detta blir ofta bilagor till rapporten och det som problemägaren till det ursprungliga problemet (industrin) ofta vill ha.\\
% Bland dessa bilagor återfinns ofta, och enligt någon angiven standard, kravdokument, arkitekturdokument, designdokumnet, implementationsdokument, driftsdokument, testprotokoll mm.}
% \generalExpl{If this is going to be a complete document consider putting it in as an appendix, then just put the highlights here.}


\autoref{appendix:source_code} includes links to the source code developed for the research in this thesis. The source code includes a \textit{README} with comprehensive instructions for how to build, run and deploy the software.




\cleardoublepage